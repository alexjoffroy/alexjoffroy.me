---
title: Ajouter simplement la localisation √† Laravel
seo_title: Ajouter simplement la localisation √† Laravel
seo_description: Sur ce site, je voulais pouvoir √©crire des articles en anglais, mais aussi en fran√ßais. Mon site devait donc √™tre multilingue. Voyons voir l'impl√©mentation de ce syst√®me avec Laravel.
---
Quand j'ai commenc√© √† travailler sur ce site, j'ai tout de suite voulu pouvoir √©crire des articles en anglais, mais aussi en fran√ßais. Mon site devait donc √™tre multilingue.

Il existe plusieurs packages pour g√©rer la localisation dans Laravel. Le plus connu est probablement [mcamara/laravel-localization](https://github.com/mcamara/laravel-localization), que j'ai utilis√© au d√©but. Cependant, j'ai rapidement rencontr√© quelques limitations, le plus critique pour moi √©tant l'impossibilit√© de [tester unitairement les routes localis√©es](https://github.com/mcamara/laravel-localization/issues/161).

D'un autre c√¥t√©, Laravel fournit d√©j√† pas mal de fonctionnalit√©s pour g√©rer [la localisation](https://laravel.com/docs/5.6/localization). Il me restait donc √† coder un syst√®me dynamique pour changer la locale en fonction de la route, tel que:

```bash
GET /en/about # Displays the about page in english
GET /fr/a-propos # Displays the about page in french
```
Voyons voir comment j'ai impl√©ment√© √ßa.


## La base Laravel

La documentation Laravel dispose [d'une section d√©di√©e](https://laravel.com/docs/5.6/localization) √† la localisation. Voici les principales fonctionnalit√©s.

### Locale

En premier lieu, dans `config/app.php`, nous pouvons configurer la locale de l'application:

```php
/*
|--------------------------------------------------------------------------
| Application Locale Configuration
|--------------------------------------------------------------------------
|
| The application locale determines the default locale that will be used
| by the translation service provider. You are free to set this value
| to any of the locales which will be supported by the application.
|
*/

'locale' => 'en',
```

Cette valeur peut-√™tre chang√©e pendant l'ex√©cution:

```php
app()->setLocale('fr');

// And we can get it
app()->getLocale(); // 'fr'
app()->isLocale('fr'); // true
```

### Traductions

On peut √©galement g√©rer nos traductions en les renseignant dans  `resources/lang`:
```php
// resources/lang/en/general.php
return [
    'about' => 'About'
];

// resources/lang/fr/general.php
return [
    'about' => '√Ä propos'
];
```

On peut ensuite retrouver ces cha√Ænes en fonction de la valeur de la locale:
```php
app()->setLocale('en');
trans('general.about') // About
trans('general.about', 'fr') // √Ä propos

app()->setLocale('fr');
trans('general.about') // √Ä propos
```

## Le syst√®me de localisation dynamique

Gr√¢ce √† ces fonctionnalit√©s, nous pouvons maintenant cr√©er notre syst√®me.

### Configurer la locale dynamiquement

Nous voulons d√©finir la locale en fonction de l'URL utilis√©e:
- `/en/about` d√©finit la locale √† `en`
- `/fr/about` d√©finit la locale √† `fr`
- ...

Pour cela, nous pouvons utiliser un middleware:
```php
// app/Http/Middlewares/SetLocale.php

public function handle(Request $request, Closure $next): Response
{
    $locale = $request->segment(1, 'en'); // `en` or `fr`

    app()->setLocale($locale);

    return $next($request);
}
```

### Enregitrer les routes

Nous pouvons √† pr√©sent √©crire nos routes:
```php
// routes/web.php

Route::get('/en/about', function() {
    return trans('general.about');
});

Route::get('/fr/about', function() {
    return trans('general.about');
});
```

Ce qui peut facilement se factoriser:
```php
// routes/web.php

foreach(['en', 'fr'] as $locale) {
    Route::prefix($locale)->group(function() {
        Route::get('about', function() {
            return trans('general.about');
        });
    })
}
```

### Localiser l'URL

Maintenant, il serait bien de pouvoir localiser l'URL, c'est-√†-dire d'avoir `/en/about`, `fr/a-propos`, etc. C'est plus lisible pour l'utilisateur, mais aussi plus optimis√© pour le SEO.Modifions l√©g√©rement notre fichier route:

```php
// routes/web.php

foreach(['en', 'fr'] as $locale) {
    Route::prefix($locale)->group(function() use ($locale) {
        Route::get(trans('routes.about', $locale), function() {
            return trans('general.about');
        });
    });
}
```

Ensuite, ajoutons les traductions des routes dans le r√©pertoire `resources/lang`:
```php
// resources/lang/en/routes.php
return [
    'about' => 'about'
];

// resources/lang/fr/routes.php
return [
    'about' => 'a-propos'
];
```

Nous avons maintenant:
- `/en/about` initialise la locale √† `en`
- `/fr/a-propos` initialise la locale √† `fr`

Parfait.

### Quelques id√©es d'am√©liorations

Le code ci-dessus pr√©sente la logique de base pour un syst√®me de localisation. On peut facilement penser √† quelques am√©liorations.

Vous voudriez surement pouvoir g√©n√©rer des routes en fonction de la locale actuelle, dans le but de construire un menu par exemple:

```php
// Maybe we can have this
localeRoute('about'); // '/en/about'
app()->setLocale('fr');
localeRoute('about'); // '/fr/a-propos'
```

Ensuite, peut-√™tre que vous voudriez pouvoir changer la locale de l'URL courante:
```php
// Current URL is '/en/about'
switchRoute(); // '/fr/a-propos'
```

Selon vos besoins, vous pourriez aussi vouloir masquer la locale par d√©faut de l'URL:
- `/about` should set the locale to `en`
- `/fr/a-propos` should set the locale to `fr`
- ...

Etc. Je crois que nous en avons assez pour √©crire un package d√©di√©. üòâ


## alexjoffroy/laravel-localization

Nous avons vu les bases du syst√®me de localisation utilis√© sur ce site. Je me suis dit que √ßa serait une bonne id√©e de l'extraire dans un package √† r√©utiliser dans d'autres projets. Et peut-√™tre aussi dans les votres !

Voici quelques fonctionnalit√©s sympas de ce package.

### Enregistrer facilement ses routes avec la macro `locales`

```php
// routes/web.php

Route::locales(function() {
    Route::get(
        trans('routes.about'), 
        'App\Http\Controllers\AboutController@index'
    )->name('about');
});
```

En savoir plus dans  [la section "Add your routes"](https://github.com/alexjoffroy/laravel-localization/tree/ed3b10463e0373698523fef78b44c4001b372ee0#add-your-routes) de la documentation.

### L'objet Localization 

La classe `\AlexJoffroy\Localization\Localization` fournit un ensemble de m√©thodes qui peuvent √™tre utilies dans votre app. L'objet est enregistr√© en tant que singleton et peut-√™tre acc√©d√© par le container, la facade `L10n` ou le helper `l10n()`.

```php
$l10n = app('localization');
// or
$l10n = L10n::getFacadeRoot();
// or
$l10n = l10n();
```

Il y a plusieurs m√©thodes utiles telles que:
- `isCurrentLocale`
- `isDefaultLocale`
- `isSupportedLocale`
- `getSupportedLocales`

En savoir plus dans [la section "Localization instance"](https://github.com/alexjoffroy/laravel-localization/tree/ed3b10463e0373698523fef78b44c4001b372ee0#the-localization-instance) de la documentation.

### G√©n√©rer les routes

Vous pouvez facilement g√©n√©rer les routes correspondantes aux locales gr√¢ce √† la m√©thode `Localization::locale`:
```php
l10n()->route('about', [], true, 'fr'); // `https://yourapp.com/fr/a-propos`

// Shortcut will fallback to current locale
l10n()->route('about'); // `https://yourapp.com/en/about` 
```

Vous pouvez √©galement changer la locale de la route courante:
```php
// Given the current app url is `https://yourapp.com/en/about`

l10n()->currentRoute('fr'); // `https://yourapp.com/fr/a-propos`
```

En savoir plus dans [la section "Generate routes"](https://github.com/alexjoffroy/laravel-localization/tree/ed3b10463e0373698523fef78b44c4001b372ee0#generate-routes) de la documentation.

### Le switch


Vous voudrez surement afficher un s√©lecteur permettant aux utilisateurs de choisir leur langage. Ceci est facilement faisable dans une vue:
```php
{{ l10n()->renderSwitch() }}
```

En savoir plus dans [la section "Render switch"](https://github.com/alexjoffroy/laravel-localization/tree/ed3b10463e0373698523fef78b44c4001b372ee0#render-switch) de la documentation.


### Et bien plus

Middleware, helpers, et d'autres choses permettent de rendre le package aussi polyvalent que possible . Ce package n'est probablement pas le plus exhaustif, il est orient√© et a quelques limitations. Mais il fait les choses comme il faut dans mon cas, donc pourquoi pas pour vous ?

Merci de consulter [la documentation sur Github](https://github.com/alexjoffroy/laravel-localization) pour avoir plus d'infos sur l'installation, la configuration et l'usage.

J'√©sp√®re que vous avez appr√©ci√© ! N'h√©sitez pas √† partager vos questions ou vos commentaires [sur Twitter](https://twitter.com/alexjoffroy) üòâ